<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>مشاهدة الفيديو | عقارك</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="icon" type="image/png" href="logo.png" />
    <link rel="apple-touch-icon" href="logo.png" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",

        "@type": "RealEstateAgent",

        "name": "منصة عقارك - Aqarak",

        "alternateName": ["Aqarak EG", "شركة عقارك", "Aqarak Real Estate"],

        "url": "https://aqarakeg.com",

        "logo": "https://aqarakeg.com/logo.jpg",

        "image": "https://aqarakeg.com/logo.jpg",

        "description": "منصة عقارك هي الوجهة الأولى لبيع وشراء وإيجار العقارات في مصر بأقل عمولة. نحن شركة متخصصة في توفير حلول عقارية ذكية وسريعة.",

        "address": {
          "@type": "PostalAddress",

          "addressLocality": "Cairo",

          "addressCountry": "EG"
        },

        "priceRange": "$",

        "contactPoint": {
          "@type": "ContactPoint",

          "telephone": "+201008102237",

          "contactType": "customer service",

          "areaServed": "EG",

          "availableLanguage": ["Arabic"]
        },

        "sameAs": [
          "https://www.facebook.com/share/1ADgNDLXc6/",

          "https://www.instagram.com/aqarak.eg?igsh=eDN2d2tuNmxhazY5",

          "https://whatsapp.com/channel/0029Vb6YH08CxoAoe7aaSP38"
        ]
      }
    </script>
    <style>
      body {
        margin: 0;
        background: #0f172a;
        color: white;
        font-family: "Cairo", sans-serif;
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
      }

      .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 1rem;
        transition: 0.3s;
        z-index: 100;
        backdrop-filter: blur(5px);
      }
      .close-btn:hover {
        background: #e74c3c;
      }

      .video-counter {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.5);
        padding: 5px 15px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 1.1rem;
        letter-spacing: 2px;
        z-index: 100;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .video-box {
        width: 80%;
        max-width: 900px;
        aspect-ratio: 16/9;
        background: black;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        transition: all 0.5s ease;
        z-index: 10;
      }

      .video-box.shorts-mode {
        aspect-ratio: 9/16;
        width: auto;
        height: 80vh;
        max-width: 100%;
      }

      iframe {
        width: 100%;
        height: 100%;
        border: none;
      }

      .nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: 0.3s;
        z-index: 20;
        font-size: 1.2rem;
        backdrop-filter: blur(5px);
      }

      .nav-btn:hover {
        background: white;
        color: #0f172a;
        transform: translateY(-50%) scale(1.1);
      }

      .nav-btn:disabled {
        opacity: 0.2;
        cursor: not-allowed;
        background: transparent;
        border-color: transparent;
      }

      .prev-btn {
        right: 30px;
      }
      .next-btn {
        left: 30px;
      }

      @media (max-width: 768px) {
        .video-box {
          width: 100%;
          border-radius: 0;
          border: none;
        }
        .video-box.shorts-mode {
          height: 100vh;
          border-radius: 0;
        }
        .nav-btn {
          width: 40px;
          height: 40px;
          font-size: 1rem;
          background: rgba(0, 0, 0, 0.3);
        }
        .prev-btn {
          right: 10px;
        }
        .next-btn {
          left: 10px;
        }
        .close-btn {
          top: 10px;
          right: 10px;
          padding: 5px 15px;
          font-size: 0.9rem;
        }
        .video-counter {
          top: 60px;
        }
      }
    </style>
  </head>
  <body>
    <button class="close-btn" onclick="history.back()">إغلاق ✕</button>

    <div class="video-counter">
      <span id="current">1</span> / <span id="total">1</span>
    </div>

    <button class="nav-btn prev-btn" id="prev-btn" onclick="changeVideo(-1)">
      <i class="fas fa-chevron-right"></i>
    </button>

    <button class="nav-btn next-btn" id="next-btn" onclick="changeVideo(1)">
      <i class="fas fa-chevron-left"></i>
    </button>

    <div class="video-box"></div>

    <script>
      const videos = JSON.parse(
        localStorage.getItem("activePropertyVideos") || "[]"
      );
      let currentIndex = 0;

      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const currentSpan = document.getElementById("current");
      const totalSpan = document.getElementById("total");
      const videoBox = document.querySelector(".video-box");

      function getYouTubeID(url) {
        const regExp =
          /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=|shorts\/)([^#&?]*).*/;
        const match = url.match(regExp);
        return match && match[2].length === 11 ? match[2] : null;
      }

      function loadVideo(index) {
        if (videos.length === 0) return;

        const url = videos[index];
        const videoId = getYouTubeID(url);

        const isShorts = url.includes("shorts");
        if (isShorts) {
          videoBox.classList.add("shorts-mode");
        } else {
          videoBox.classList.remove("shorts-mode");
        }

        videoBox.innerHTML = "";

        if (videoId) {
          const iframe = document.createElement("iframe");
          iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&showinfo=0`;
          iframe.allow = "autoplay; encrypted-media";
          iframe.allowFullscreen = true;

          videoBox.appendChild(iframe);
        }

        currentSpan.innerText = index + 1;
        totalSpan.innerText = videos.length;

        prevBtn.disabled = index === 0;
        nextBtn.disabled = index === videos.length - 1;
      }

      function changeVideo(direction) {
        const newIndex = currentIndex + direction;
        if (newIndex >= 0 && newIndex < videos.length) {
          currentIndex = newIndex;
          loadVideo(currentIndex);
        }
      }

      if (videos.length > 0) {
        loadVideo(0);
      } else {
        alert("لا توجد فيديوهات للعرض");
        history.back();
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") changeVideo(-1);
        if (e.key === "ArrowLeft") changeVideo(1);
        if (e.key === "Escape") history.back();
      });
    </script>
    <script src="ban-check.js"></script>
    <script src="global-alert.js"></script>
  </body>
</html>
